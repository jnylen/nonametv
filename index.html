<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Nonametv by xmltv-se</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Nonametv</h1>
      <h2 class="project-tagline">Convert tv-listings to xmltv format</h2>
      <a href="https://github.com/xmltv-se/nonametv" class="btn">View on GitHub</a>
      <a href="https://github.com/xmltv-se/nonametv/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/xmltv-se/nonametv/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p>The system consists of three main parts: the Importers, the Database
and the Exporters.</p>

<h2>
<a id="importers" class="anchor" href="#importers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>IMPORTERS</h2>

<p>Importers are used to import data from different sources into the database.
There is one importers for each data provider. All importers inherit
from the NonameTV::Importer class and thus provide a consistent interface.</p>

<p>Data is imported in batches. A batch is the smallest unit of data that
can be identified by the importer. Usually, a batch corresponds to
a file provided by the data provider.</p>

<p>All Importers that import data via HTTP inherit from one of
NonameTV::Importer::BaseOne, BaseDaily or BaseWeekly. These baseclasses
provide helper-functions that handle data provided in a single file per
channel, one file per day and channel or one file per week and channel.</p>

<p>There is an override-mechanism implemented in the importers that can be
used to override faulty data provided by the data-providers. Sometimes
the data is plain wrong and you need to edit it before feeding it to
the importers. See tools/nonametv-import-download for instructions.</p>

<p>The Importers are run via the command-line tool tools/nonametv-import:</p>

<p>perl -I lib tools/nonametv-import Infomedia --verbose</p>

<h2>
<a id="database" class="anchor" href="#database" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DATABASE</h2>

<p>All data is stored in a MySQL-database in a consistent format. All
strings are encoded in utf-8 in the database and all times are stored
in UTC-timezone.  The channels and trans_cat tables are updated
manually (using the mysql frontend of your choice.) The programs and
batches tables are updated by the Importers and cannot be updated
manually.</p>

<h2>
<a id="exporters" class="anchor" href="#exporters" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>EXPORTERS</h2>

<p>The Exporters take the data in the database and export it in another format.
The only Exporter that exist today is the Xmltv exporter that exports data
in a format that tv_grab_se_swedb can utilize.</p>

<h2>
<a id="avoiding-unnecessary-updates" class="anchor" href="#avoiding-unnecessary-updates" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AVOIDING UNNECESSARY UPDATES</h2>

<p>tv_grab_se_swedb utilizes http-caching to avoid downloading data that
hasn't changed since the last time tv_grab_se_swedb was run. This
saves a lot of bandwidth for the server if utilized correctly.</p>

<p>Additionally, some of the Importers take a lot of time to run and we want
to avoid Importing data if nothing has changed. There are a number of
mechanisms in place to avoid doing unnecessary work:</p>

<p>All Importers use HTTP-caching (if they fetch data via HTTP) and only
processes data if it has actually changed since it was last downloaded.
To force an update (for example if the Importer-code has been improved),
use the parameter --force-update:</p>

<p>perl -I lib tools/nonametv-import Infomedia --force-update</p>

<p>The Exporter only exports data for batches that have actually changed.
Furthermore, after exporting a file, the Exporter checks to see if the
exported file is different from the previous file for that period. If
the new file is identical to the old file, the old file is left untouched.</p>

<p>After the export-step, rsync is used to copy the data from the
xmltv_staging directory to the xmltv-directory. Once more, only files
that have actually changed (detected by checking file contents) are
copied. This can be useful during development, since you can do an
export, see that something went wrong (for example by using 
tools/nonametv-xmltv-compare-run and look at the changes). Then revert
your changes and run export again. Since the newly exported files are
then identical to the files in the xmltv/directory, the next run of
rsync will not copy any files even though the date on the files has been
updated.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/xmltv-se/nonametv">Nonametv</a> is maintained by <a href="https://github.com/xmltv-se">xmltv-se</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
